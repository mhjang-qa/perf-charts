<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>QA Result Pie</title>
  <style>
    :root{
      --bg:#ffffff;
      --text:#111827;
      --muted:#6b7280;

      /* 색상 */
      --pass:#0b7285; /* 청록 */
      --fail:#e03131; /* 레드 */
      --na:#f08c00;   /* 오렌지 */
    }

    html,body{
      margin:0; padding:0;
      background:var(--bg);
      color:var(--text);
      font-family: -apple-system, BlinkMacSystemFont, "Apple SD Gothic Neo", "Noto Sans KR", "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    }

    .wrap{
      max-width: 980px;
      margin: 0 auto;
      padding: 18px 16px 20px;
    }

    .title{
      font-size: 14px;
      font-weight: 800;
      margin: 0 0 10px 0;
      letter-spacing: 0.2px;
    }

    .grid{
      display: grid;
      grid-template-columns: repeat(2, minmax(240px, 1fr));
      gap: 16px;
      align-items: start;
    }

    .card{
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      padding: 12px 12px 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.04);
      background: #fff;
    }

    .cardHead{
      display:flex;
      align-items: baseline;
      justify-content: space-between;
      margin-bottom: 8px;
    }

    .cardHead .h{
      font-weight: 900;
      font-size: 13px;
      letter-spacing: 0.3px;
    }

    .cardHead .sum{
      font-size: 12px;
      color: var(--muted);
    }

    .chartRow{
      display:flex;
      gap: 12px;
      align-items: center;
      justify-content: space-between;
    }

    .svgBox{
      width: 260px;
      max-width: 60%;
      min-width: 200px;
      aspect-ratio: 16 / 9;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .legend{
      flex: 1;
      min-width: 150px;
      display:flex;
      flex-direction: column;
      gap: 8px;
    }

    .lgItem{
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 10px;
      font-size: 12px;
    }

    .lgLeft{
      display:flex;
      align-items:center;
      gap: 8px;
      color: var(--text);
      font-weight: 700;
    }

    .dot{
      width: 10px; height: 10px;
      border-radius: 999px;
      display:inline-block;
    }

    .lgRight{
      color: var(--muted);
      font-variant-numeric: tabular-nums;
      white-space: nowrap;
    }

    .foot{
      margin-top: 10px;
      font-size: 11px;
      color: var(--muted);
    }

    @media (max-width: 640px){
      .grid{ grid-template-columns: 1fr; }
      .svgBox{ max-width: 55%; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="title">OS별 테스트 결과 (PASS / FAIL / NA)</div>

    <div class="grid">
      <div class="card">
        <div class="cardHead">
          <div class="h">AOS</div>
          <div class="sum">SUM 98</div>
        </div>
        <div class="chartRow">
          <div class="svgBox">
            <svg id="pieAOS" viewBox="0 0 320 180" width="100%" height="100%" aria-label="AOS pie"></svg>
          </div>
          <div class="legend" id="legendAOS"></div>
        </div>
      </div>

      <div class="card">
        <div class="cardHead">
          <div class="h">iOS</div>
          <div class="sum">SUM 98</div>
        </div>
        <div class="chartRow">
          <div class="svgBox">
            <svg id="pieIOS" viewBox="0 0 320 180" width="100%" height="100%" aria-label="iOS pie"></svg>
          </div>
          <div class="legend" id="legendIOS"></div>
        </div>
      </div>
    </div>

    
  </div>

  <script>
    // ----------------------------
    // 데이터 (요청값)
    // ----------------------------
    const data = {
      AOS: { PASS: 51, FAIL: 9,  NA: 38, sum: 98 },
      IOS: { PASS: 55, FAIL: 6,  NA: 37, sum: 98 }
    };

    const COLORS = {
      PASS: getCss("--pass"),
      FAIL: getCss("--fail"),
      NA:   getCss("--na")
    };

    function getCss(varName){
      return getComputedStyle(document.documentElement).getPropertyValue(varName).trim();
    }

    // ----------------------------
    // 3D 파이 렌더러 (SVG)
    // ----------------------------
    function render3DPie(svgEl, legendEl, series) {
      const cx = 160, cy = 80;
      const r  = 78;
      const depth = 18;
      const startAngle = -Math.PI/2;

      const keys = ["PASS","FAIL","NA"].filter(k => (series[k] ?? 0) > 0);

      svgEl.innerHTML = "";

      const defs = el("defs");
      const filterId = uid("shadow");
      const filter = el("filter", { id: filterId, x:"-20%", y:"-20%", width:"140%", height:"160%" });
      filter.appendChild(el("feDropShadow", { dx:"0", dy:"3", stdDeviation:"3", "flood-opacity":"0.25" }));
      defs.appendChild(filter);
      svgEl.appendChild(defs);

      // 바닥 그림자
      svgEl.appendChild(el("ellipse", {
        cx, cy: cy + depth + 10,
        rx: r + 8, ry: (r * 0.28) + 6,
        fill: "#000", opacity: "0.06"
      }));

      const gBottom = el("g");
      const gTop = el("g", { filter:`url(#${filterId})` });

      const total = keys.reduce((acc,k)=> acc + (series[k]||0), 0) || 1;

      // bottom layer
      let a0 = startAngle;
      keys.forEach(k => {
        const v = series[k] || 0;
        const a1 = a0 + (v/total) * Math.PI * 2;
        gBottom.appendChild(el("path", {
          d: arcPath(cx, cy + depth, r, a0, a1),
          fill: shade(COLORS[k], -18),
          stroke: "rgba(255,255,255,0.35)",
          "stroke-width": "1"
        }));
        a0 = a1;
      });

      // top layer
      a0 = startAngle;
      keys.forEach(k => {
        const v = series[k] || 0;
        const a1 = a0 + (v/total) * Math.PI * 2;

        gTop.appendChild(el("path", {
          d: arcPath(cx, cy, r, a0, a1),
          fill: COLORS[k],
          stroke: "#ffffff",
          "stroke-width": "1.2"
        }));

        // percent label (6% 이상만)
        const pct = (v/total) * 100;
        if (pct >= 6) {
          const mid = (a0 + a1) / 2;
          const tx = cx + Math.cos(mid) * (r * 0.62);
          const ty = cy + Math.sin(mid) * (r * 0.62) + 4;

          gTop.appendChild(el("text", {
            x: tx, y: ty,
            "text-anchor": "middle",
            "dominant-baseline": "middle",
            "font-size": "12",
            "font-weight": "900",
            fill: "rgba(255,255,255,0.95)"
          }, `${pct.toFixed(0)}%`));
        }

        a0 = a1;
      });

      svgEl.appendChild(gBottom);
      svgEl.appendChild(gTop);

      // legend
      legendEl.innerHTML = "";
      keys.forEach(k => {
        const v = series[k] || 0;
        const pct = (v/total) * 100;

        const item = document.createElement("div");
        item.className = "lgItem";

        const left = document.createElement("div");
        left.className = "lgLeft";

        const dot = document.createElement("span");
        dot.className = "dot";
        dot.style.background = COLORS[k];

        const name = document.createElement("span");
        name.textContent = k;

        left.appendChild(dot);
        left.appendChild(name);

        const right = document.createElement("div");
        right.className = "lgRight";
        right.textContent = `${v} (${pct.toFixed(1)}%)`;

        item.appendChild(left);
        item.appendChild(right);
        legendEl.appendChild(item);
      });
    }

    function arcPath(cx, cy, r, a0, a1){
      const large = (a1 - a0) > Math.PI ? 1 : 0;
      const x0 = cx + r * Math.cos(a0);
      const y0 = cy + r * Math.sin(a0);
      const x1 = cx + r * Math.cos(a1);
      const y1 = cy + r * Math.sin(a1);
      return `M ${cx} ${cy} L ${x0} ${y0} A ${r} ${r} 0 ${large} 1 ${x1} ${y1} Z`;
    }

    function shade(hex, amt){
      const h = hex.replace("#","");
      const num = parseInt(h,16);
      let r = (num >> 16) & 255;
      let g = (num >> 8) & 255;
      let b = num & 255;
      r = clamp(r + amt, 0, 255);
      g = clamp(g + amt, 0, 255);
      b = clamp(b + amt, 0, 255);
      return "#" + ((1<<24) + (r<<16) + (g<<8) + b).toString(16).slice(1);
    }

    function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }

    function el(tag, attrs={}, text=null){
      const n = document.createElementNS("http://www.w3.org/2000/svg", tag);
      Object.entries(attrs).forEach(([k,v])=> n.setAttribute(k,String(v)));
      if (text !== null) n.textContent = text;
      return n;
    }

    function uid(prefix){
      return prefix + "_" + Math.random().toString(16).slice(2);
    }

    // render
    render3DPie(document.getElementById("pieAOS"), document.getElementById("legendAOS"), data.AOS);
    render3DPie(document.getElementById("pieIOS"), document.getElementById("legendIOS"), data.IOS);
  </script>
</body>
</html>
